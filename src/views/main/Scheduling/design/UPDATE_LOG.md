# 排班系統更新日誌

## 2026-01-20 - 資料結構重構完成

### ✅ 已完成更新

#### 1. ListView.vue - 列表視圖（全面更新）

**顯示邏輯更新**：
- ✅ 機台卡片支援顯示多個品號
- ✅ 每個品號顯示：品號、優先級、人力代碼、操作人員、備註
- ✅ 操作人員顯示完整物件資訊（含時間）
- ✅ 整體狀態計算（基於所有品號的狀態）

**編輯功能更新**：
- ✅ 編輯對話框支援多品號編輯
- ✅ 可新增/刪除品號
- ✅ 每個品號可獨立管理操作人員
- ✅ 支援時間設定（開始時間/結束時間）

**拖拉功能更新**：
- ✅ 拖拉邏輯支援新格式（品號索引 + 操作人員索引）

**輔助函數**：
- ✅ `getOverallStatus()` - 計算機台整體狀態
- ✅ `formatTime()` - 格式化時間顯示
- ✅ `addProduct()` - 新增品號
- ✅ `removeProduct()` - 移除品號
- ✅ `addOperator()` - 新增操作人員（需指定品號）
- ✅ `removeOperator()` - 移除操作人員（需指定品號和操作人員索引）

#### 2. 核心服務（已完成）
- ✅ `schedulingService.js` - 產生新格式排班資料
- ✅ `scheduleDataAdapter.js` - 資料轉換工具
- ✅ `index.vue` - 主頁面自動轉換邏輯

### ⏳ 待完成

#### 3. TableView.vue - 表格視圖
- [ ] 更新表格顯示以支援多品號
- [ ] 更新編輯功能
- [ ] 更新拖拉功能

#### 4. OverviewView.vue - 總覽視圖
- [ ] 更新總覽顯示以支援多品號
- [ ] 更新編輯功能

## 新資料結構

### 機台層級
```json
{
  "machineNumber": "10",
  "machineName": "機台10號",
  "products": [...]
}
```

### 品號層級
```json
{
  "productCode": "00-110188分模-紅色",
  "priority": "空白",
  "laborCode": "自1",
  "operators": [...],
  "status": "已排",
  "remark": ""
}
```

### 操作人員層級
```json
{
  "snkey": "2",
  "name": "人員2號",
  "startTime": "08:00",
  "endTime": "12:00"
}
```

## 測試步驟

### 1. 測試列表視圖顯示
1. 執行自動排班
2. 切換到「列表」視圖
3. 檢查機台卡片是否正確顯示品號資訊
4. 檢查操作人員是否正確顯示

### 2. 測試編輯功能
1. 點擊任一機台卡片
2. 應該看到新的編輯對話框（支援多品號）
3. 測試新增品號
4. 測試新增/移除操作人員
5. 測試儲存功能

### 3. 測試自動排班
1. 在步驟1輸入品號
2. 點擊「自動排班」
3. 檢查產生的資料格式（在 Console 查看）
4. 應該看到新格式的資料

## 向後兼容性

系統會自動將舊格式資料轉換為新格式：
- **讀取時**：`loadSchedule()` 自動轉換
- **顯示時**：ListView 支援新格式顯示
- **儲存時**：使用新格式儲存

## 已知問題

1. **拖拉功能**：
   - 移除區域拖放邏輯需要更新以支援品號索引
   - 機台間拖放邏輯需要更新

2. **TableView 和 OverviewView**：
   - 尚未更新，暫時無法正確顯示新格式資料

## 下一步

建議優先順序：
1. ✅ 測試 ListView 的編輯和顯示功能
2. 🔄 完成拖拉功能的完整更新
3. ⏳ 更新 TableView.vue
4. ⏳ 更新 OverviewView.vue
5. ⏳ 全面測試並修正問題
